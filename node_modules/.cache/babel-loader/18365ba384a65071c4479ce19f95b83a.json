{"ast":null,"code":"var _jsxFileName = \"/home/jingyi/my-fullstack-app/site/src/pages/Auth/Auth.js\";\nimport React, { Component } from 'react';\nimport { Link, withRouter } from 'react-router-dom';\nimport Loading from '../../fragments/Loading';\nimport styles from './Auth.module.css';\nimport { userRegister, userLogin, userGet, saveSession } from '../../utils';\n\nclass Auth extends Component {\n  constructor(props) {\n    super(props);\n    const pathName = window.location.pathname.replace('/', '');\n    this.state = {};\n    this.state.state = pathName;\n    this.state.loading = true;\n    this.state.error = null;\n    this.state.formEmail = '';\n    this.state.formPassword = ''; // Bindings\n\n    this.handleFormInput = this.handleFormInput.bind(this);\n    this.handleFormSubmit = this.handleFormSubmit.bind(this);\n    this.handleFormTypeChange = this.handleFormTypeChange.bind(this);\n  }\n  /**\n   * Component did mount\n   */\n\n\n  componentDidMount() {\n    this.setState({\n      loading: false\n    }); // Clear query params\n\n    const url = document.location.href;\n    window.history.pushState({}, '', url.split('?')[0]);\n  }\n  /**\n   * Handles a form change\n   */\n\n\n  handleFormTypeChange(type) {\n    this.setState({\n      state: type\n    }, () => {\n      this.props.history.push(`/${type}`);\n    });\n  }\n  /**\n   * Handle text changes within form fields\n   */\n\n\n  handleFormInput(field, value) {\n    value = value.trim();\n    const nextState = {};\n    nextState[field] = value;\n    this.setState(Object.assign(this.state, nextState));\n  }\n  /**\n   * Handles form submission\n   * @param {object} evt \n   */\n\n\n  async handleFormSubmit(evt) {\n    evt.preventDefault();\n    this.setState({\n      loading: true\n    }); // Validate email\n\n    if (!this.state.formEmail) {\n      return this.setState({\n        loading: false,\n        formError: 'email is required'\n      });\n    } // Validate password\n\n\n    if (!this.state.formPassword) {\n      return this.setState({\n        loading: false,\n        formError: 'password is required'\n      });\n    }\n\n    let token;\n\n    try {\n      if (this.state.state === 'register') {\n        token = await userRegister(this.state.formEmail, this.state.formPassword);\n      } else {\n        token = await userLogin(this.state.formEmail, this.state.formPassword);\n      }\n    } catch (error) {\n      console.log(error);\n\n      if (error.message) {\n        this.setState({\n          formError: error.message,\n          loading: false\n        });\n      } else {\n        this.setState({\n          formError: 'Sorry, something unknown went wrong.  Please try again.',\n          loading: false\n        });\n      }\n\n      return;\n    } // Fetch user record and set session in cookie\n\n\n    let user = await userGet(token.token);\n    user = user.user;\n    saveSession(user.id, user.email, token.token);\n    window.location.replace('/');\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: `${styles.container} animateFadeIn`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.containerInner,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/\",\n      className: `${styles.logo}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      draggable: \"false\",\n      src: './fullstack-app-title.png',\n      alt: \"serverless-fullstack-application\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 13\n      }\n    })), this.state.loading && /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Loading, {\n      className: styles.containerLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 16\n      }\n    })), !this.state.loading && /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.formType,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: `${styles.formTypeRegister} \n                ${this.state.state === 'register' ? styles.formTypeActive : ''}`,\n      onClick: e => {\n        this.handleFormTypeChange('register');\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 15\n      }\n    }, \"Register\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: `${styles.formTypeSignIn} \n                ${this.state.state === 'login' ? styles.formTypeActive : ''}`,\n      onClick: e => {\n        this.handleFormTypeChange('login');\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }\n    }, \"Sign-In\")), this.state.state === 'register' && !this.state.loading && /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.containerRegister,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      className: styles.form,\n      onSubmit: this.handleFormSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.formField,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: styles.formLabel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 19\n      }\n    }, \"email\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      placeholder: \"yours@example.com\",\n      className: styles.formInput,\n      value: this.state.formEmail,\n      onChange: e => {\n        this.handleFormInput('formEmail', e.target.value);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 19\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.formField,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: styles.formLabel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 19\n      }\n    }, \"password\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"password\",\n      placeholder: \"your password\",\n      className: styles.formInput,\n      value: this.state.formPassword,\n      onChange: e => {\n        this.handleFormInput('formPassword', e.target.value);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 19\n      }\n    })), this.state.formError && /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.formError,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 19\n      }\n    }, this.state.formError), /*#__PURE__*/React.createElement(\"input\", {\n      className: `buttonPrimaryLarge ${styles.formButton}`,\n      type: \"submit\",\n      value: \"Register\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 17\n      }\n    }))), this.state.state === 'login' && !this.state.loading && /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.containerSignIn,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      className: styles.form,\n      onSubmit: this.handleFormSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.formField,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: styles.formLabel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 19\n      }\n    }, \"email\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      placeholder: \"yours@example.com\",\n      className: styles.formInput,\n      value: this.state.formEmail,\n      onChange: e => {\n        this.handleFormInput('formEmail', e.target.value);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 19\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.formField,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      className: styles.formLabel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 19\n      }\n    }, \"password\"), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"password\",\n      placeholder: \"your password\",\n      className: styles.formInput,\n      value: this.state.formPassword,\n      onChange: e => {\n        this.handleFormInput('formPassword', e.target.value);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 19\n      }\n    })), this.state.formError && /*#__PURE__*/React.createElement(\"div\", {\n      className: styles.formError,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 19\n      }\n    }, this.state.formError), /*#__PURE__*/React.createElement(\"input\", {\n      className: `buttonPrimaryLarge ${styles.formButton}`,\n      type: \"submit\",\n      value: \"Sign In\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }\n    })))));\n  }\n\n}\n\nexport default withRouter(Auth);","map":{"version":3,"sources":["/home/jingyi/my-fullstack-app/site/src/pages/Auth/Auth.js"],"names":["React","Component","Link","withRouter","Loading","styles","userRegister","userLogin","userGet","saveSession","Auth","constructor","props","pathName","window","location","pathname","replace","state","loading","error","formEmail","formPassword","handleFormInput","bind","handleFormSubmit","handleFormTypeChange","componentDidMount","setState","url","document","href","history","pushState","split","type","push","field","value","trim","nextState","Object","assign","evt","preventDefault","formError","token","console","log","message","user","id","email","render","container","containerInner","logo","containerLoading","formType","formTypeRegister","formTypeActive","e","formTypeSignIn","containerRegister","form","formField","formLabel","formInput","target","formButton","containerSignIn"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport {\n  Link,\n  withRouter,\n} from 'react-router-dom'\nimport Loading from '../../fragments/Loading'\nimport styles from './Auth.module.css'\nimport {\n  userRegister,\n  userLogin,\n  userGet,\n  saveSession,\n} from '../../utils'\n\nclass Auth extends Component {\n\n  constructor(props) {\n    super(props)\n\n    const pathName = window.location.pathname.replace('/', '')\n\n    this.state = {}\n    this.state.state = pathName\n    this.state.loading = true\n    this.state.error = null\n    this.state.formEmail = ''\n    this.state.formPassword = ''\n\n    // Bindings\n    this.handleFormInput = this.handleFormInput.bind(this)\n    this.handleFormSubmit = this.handleFormSubmit.bind(this)\n    this.handleFormTypeChange = this.handleFormTypeChange.bind(this)\n  }\n\n  /**\n   * Component did mount\n   */\n  componentDidMount() {\n    this.setState({\n      loading: false\n    })\n\n    // Clear query params\n    const url = document.location.href\n    window.history.pushState({}, '', url.split('?')[0])\n  }\n\n  /**\n   * Handles a form change\n   */\n  handleFormTypeChange(type) {\n    this.setState({ state: type },\n      () => {\n        this.props.history.push(`/${type}`)\n      })\n  }\n\n  /**\n   * Handle text changes within form fields\n   */\n  handleFormInput(field, value) {\n    value = value.trim()\n\n    const nextState = {}\n    nextState[field] = value\n\n    this.setState(Object.assign(this.state, nextState))\n  }\n\n  /**\n   * Handles form submission\n   * @param {object} evt \n   */\n  async handleFormSubmit(evt) {\n    evt.preventDefault()\n\n    this.setState({ loading: true })\n\n    // Validate email\n    if (!this.state.formEmail) {\n      return this.setState({\n        loading: false,\n        formError: 'email is required'\n      })\n    }\n\n    // Validate password\n    if (!this.state.formPassword) {\n      return this.setState({\n        loading: false,\n        formError: 'password is required'\n      })\n    }\n\n    let token\n    try {\n      if (this.state.state === 'register') {\n        token = await userRegister(this.state.formEmail, this.state.formPassword)\n      } else {\n        token = await userLogin(this.state.formEmail, this.state.formPassword)\n      }\n    } catch (error) {\n      console.log(error)\n      if (error.message) {\n        this.setState({\n          formError: error.message,\n          loading: false\n        })\n      } else {\n        this.setState({\n          formError: 'Sorry, something unknown went wrong.  Please try again.',\n          loading: false\n        })\n      }\n      return\n    }\n\n    // Fetch user record and set session in cookie\n    let user = await userGet(token.token)\n    user = user.user\n    saveSession(user.id, user.email, token.token)\n\n    window.location.replace('/')\n  }\n\n  render() {\n\n    return (\n      <div className={`${styles.container} animateFadeIn`}>\n        <div className={styles.containerInner}>\n\n          { /* Logo */}\n\n          <Link to='/' className={`${styles.logo}`}>\n            <img\n              draggable='false'\n              src={'./fullstack-app-title.png'}\n              alt='serverless-fullstack-application'\n            />\n          </Link>\n\n          { /* Loading */}\n\n          {this.state.loading && (\n            <div>\n              {< Loading className={styles.containerLoading} />}\n            </div>\n          )}\n\n          { /* Registration Form */}\n\n          {!this.state.loading && (\n            <div className={styles.formType}>\n              <div\n                className={\n                  `${styles.formTypeRegister} \n                ${this.state.state === 'register' ? styles.formTypeActive : ''}`}\n                onClick={(e) => { this.handleFormTypeChange('register') }}>\n                Register\n              </div>\n              <div\n                className={\n                  `${styles.formTypeSignIn} \n                ${this.state.state === 'login' ? styles.formTypeActive : ''}`}\n                onClick={(e) => { this.handleFormTypeChange('login') }}>\n                Sign-In\n              </div>\n            </div>\n          )}\n\n          {this.state.state === 'register' && !this.state.loading && (\n            <div className={styles.containerRegister}>\n\n              <form className={styles.form} onSubmit={this.handleFormSubmit}>\n                <div className={styles.formField}>\n                  <label className={styles.formLabel}>email</label>\n                  <input\n                    type='text'\n                    placeholder='yours@example.com'\n                    className={styles.formInput}\n                    value={this.state.formEmail}\n                    onChange={(e) => { this.handleFormInput('formEmail', e.target.value) }}\n                  />\n                </div>\n                <div className={styles.formField}>\n                  <label className={styles.formLabel}>password</label>\n                  <input\n                    type='password'\n                    placeholder='your password'\n                    className={styles.formInput}\n                    value={this.state.formPassword}\n                    onChange={(e) => { this.handleFormInput('formPassword', e.target.value) }}\n                  />\n                </div>\n\n                {this.state.formError && (\n                  <div className={styles.formError}>{this.state.formError}</div>\n                )}\n\n                <input\n                  className={`buttonPrimaryLarge ${styles.formButton}`}\n                  type='submit'\n                  value='Register'\n                />\n\n              </form>\n            </div>\n          )}\n\n          {this.state.state === 'login' && !this.state.loading && (\n            <div className={styles.containerSignIn}>\n\n              <form className={styles.form} onSubmit={this.handleFormSubmit}>\n                <div className={styles.formField}>\n                  <label className={styles.formLabel}>email</label>\n                  <input\n                    type='text'\n                    placeholder='yours@example.com'\n                    className={styles.formInput}\n                    value={this.state.formEmail}\n                    onChange={(e) => { this.handleFormInput('formEmail', e.target.value) }}\n                  />\n                </div>\n                <div className={styles.formField}>\n                  <label className={styles.formLabel}>password</label>\n                  <input\n                    type='password'\n                    placeholder='your password'\n                    className={styles.formInput}\n                    value={this.state.formPassword}\n                    onChange={(e) => { this.handleFormInput('formPassword', e.target.value) }}\n                  />\n                </div>\n\n                {this.state.formError && (\n                  <div className={styles.formError}>{this.state.formError}</div>\n                )}\n\n                <input className={`buttonPrimaryLarge ${styles.formButton}`} type='submit' value='Sign In' />\n              </form>\n            </div>\n          )}\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default withRouter(Auth)"]},"metadata":{},"sourceType":"module"}